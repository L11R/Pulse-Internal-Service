'use strict';

function WebSocketClient() {
    this.number = 0; // Message number
    this.autoReconnectInterval = 1000; // ms
}
WebSocketClient.prototype.open = function (url) {
    var _this = this;

    this.url = url;
    this.instance = new WebSocket(this.url);
    this.instance.onopen = function () {
        _this.onopen();
    };
    this.instance.onmessage = function (data, flags) {
        _this.number++;
        _this.onmessage(data, flags, _this.number);
    };
    this.instance.onclose = function (e) {
        switch (e) {
            case 1000:
                // CLOSE_NORMAL
                console.log("WebSocket: closed");
                break;
            default:
                // Abnormal closure
                _this.reconnect(e);
                break;
        }
        _this.onclose(e);
    };
    this.instance.onerror = function (e) {
        switch (e.code) {
            case 'ECONNREFUSED':
                _this.reconnect(e);
                break;
            default:
                _this.onerror(e);
                break;
        }
    };
};
WebSocketClient.prototype.send = function (data, option) {
    try {
        this.instance.send(data, option);
    } catch (e) {
        this.instance.emit('error', e);
    }
};
WebSocketClient.prototype.reconnect = function (e) {
    console.log('WebSocketClient: retry in ' + this.autoReconnectInterval + 'ms', e);
    var that = this;
    setTimeout(function () {
        console.log("WebSocketClient: reconnecting...");
        that.open(that.url);
    }, this.autoReconnectInterval);
};
WebSocketClient.prototype.onopen = function (e) {
    console.log("WebSocketClient: open", arguments);
};
WebSocketClient.prototype.onmessage = function (data, flags, number) {
    console.log("WebSocketClient: message", arguments);
};
WebSocketClient.prototype.onerror = function (e) {
    console.log("WebSocketClient: error", arguments);
};
WebSocketClient.prototype.onclose = function (e) {
    console.log("WebSocketClient: closed", arguments);
};

var sock = new WebSocketClient();
sock.open('ws://' + window.location.host + '/ui/ws');
sock.onmessage = function (event) {
    console.log(event);
    var obj = JSON.parse(event.data);
    console.log(obj);

    if (obj.do_reload === true) {
        document.location.reload(true);
    } else if (obj.cell_event) {
        var cell_id = obj.cell_event.cell_id;
        var $cell = $("#cell-" + cell_id);
        // Reset classes. TODO: find more generic way
        $cell.removeClass("opened");
        $cell.removeClass("dirty");
        $cell.removeClass("operational");
        $cell.removeClass("broken");
        $cell.removeClass("blocked");
        $cell.addClass(obj.cell_event.cell_state);
        if (obj.cell_event.is_open && obj.cell_event.cell_state == "operational") {
            $cell.addClass("opened");
        }
        $cell.find('span').text(obj.cell_event.cell_state);
    }
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndzX3JlbG9hZC5qcyJdLCJuYW1lcyI6WyJXZWJTb2NrZXRDbGllbnQiLCJudW1iZXIiLCJhdXRvUmVjb25uZWN0SW50ZXJ2YWwiLCJwcm90b3R5cGUiLCJvcGVuIiwidXJsIiwiaW5zdGFuY2UiLCJXZWJTb2NrZXQiLCJvbm9wZW4iLCJvbm1lc3NhZ2UiLCJkYXRhIiwiZmxhZ3MiLCJvbmNsb3NlIiwiZSIsImNvbnNvbGUiLCJsb2ciLCJyZWNvbm5lY3QiLCJvbmVycm9yIiwiY29kZSIsInNlbmQiLCJvcHRpb24iLCJlbWl0IiwidGhhdCIsInNldFRpbWVvdXQiLCJhcmd1bWVudHMiLCJzb2NrIiwid2luZG93IiwibG9jYXRpb24iLCJob3N0IiwiZXZlbnQiLCJvYmoiLCJKU09OIiwicGFyc2UiLCJkb19yZWxvYWQiLCJkb2N1bWVudCIsInJlbG9hZCIsImNlbGxfZXZlbnQiLCJjZWxsX2lkIiwiJGNlbGwiLCIkIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImNlbGxfc3RhdGUiLCJpc19vcGVuIiwiZmluZCIsInRleHQiXSwibWFwcGluZ3MiOiI7O0FBQ0EsU0FBU0EsZUFBVCxHQUEwQjtBQUN0QixTQUFLQyxNQUFMLEdBQWMsQ0FBZCxDQURzQixDQUNMO0FBQ2pCLFNBQUtDLHFCQUFMLEdBQTZCLElBQTdCLENBRnNCLENBRWE7QUFDdEM7QUFDREYsZ0JBQWdCRyxTQUFoQixDQUEwQkMsSUFBMUIsR0FBaUMsVUFBU0MsR0FBVCxFQUFhO0FBQUE7O0FBQzFDLFNBQUtBLEdBQUwsR0FBV0EsR0FBWDtBQUNBLFNBQUtDLFFBQUwsR0FBZ0IsSUFBSUMsU0FBSixDQUFjLEtBQUtGLEdBQW5CLENBQWhCO0FBQ0EsU0FBS0MsUUFBTCxDQUFjRSxNQUFkLEdBQXVCLFlBQU07QUFDekIsY0FBS0EsTUFBTDtBQUNILEtBRkQ7QUFHQSxTQUFLRixRQUFMLENBQWNHLFNBQWQsR0FBMEIsVUFBQ0MsSUFBRCxFQUFNQyxLQUFOLEVBQWU7QUFDckMsY0FBS1YsTUFBTDtBQUNBLGNBQUtRLFNBQUwsQ0FBZUMsSUFBZixFQUFxQkMsS0FBckIsRUFBNEIsTUFBS1YsTUFBakM7QUFDSCxLQUhEO0FBSUEsU0FBS0ssUUFBTCxDQUFjTSxPQUFkLEdBQXdCLFVBQUNDLENBQUQsRUFBSztBQUN6QixnQkFBUUEsQ0FBUjtBQUNJLGlCQUFLLElBQUw7QUFBVztBQUNQQyx3QkFBUUMsR0FBUixDQUFZLG1CQUFaO0FBQ0E7QUFDSjtBQUFTO0FBQ0wsc0JBQUtDLFNBQUwsQ0FBZUgsQ0FBZjtBQUNBO0FBTlI7QUFRQSxjQUFLRCxPQUFMLENBQWFDLENBQWI7QUFDSCxLQVZEO0FBV0EsU0FBS1AsUUFBTCxDQUFjVyxPQUFkLEdBQXdCLFVBQUNKLENBQUQsRUFBSztBQUN6QixnQkFBUUEsRUFBRUssSUFBVjtBQUNJLGlCQUFLLGNBQUw7QUFDSSxzQkFBS0YsU0FBTCxDQUFlSCxDQUFmO0FBQ0E7QUFDSjtBQUNJLHNCQUFLSSxPQUFMLENBQWFKLENBQWI7QUFDQTtBQU5SO0FBUUgsS0FURDtBQVVILENBL0JEO0FBZ0NBYixnQkFBZ0JHLFNBQWhCLENBQTBCZ0IsSUFBMUIsR0FBaUMsVUFBU1QsSUFBVCxFQUFjVSxNQUFkLEVBQXFCO0FBQ2xELFFBQUc7QUFDQyxhQUFLZCxRQUFMLENBQWNhLElBQWQsQ0FBbUJULElBQW5CLEVBQXdCVSxNQUF4QjtBQUNILEtBRkQsQ0FFQyxPQUFPUCxDQUFQLEVBQVM7QUFDTixhQUFLUCxRQUFMLENBQWNlLElBQWQsQ0FBbUIsT0FBbkIsRUFBMkJSLENBQTNCO0FBQ0g7QUFDSixDQU5EO0FBT0FiLGdCQUFnQkcsU0FBaEIsQ0FBMEJhLFNBQTFCLEdBQXNDLFVBQVNILENBQVQsRUFBVztBQUM3Q0MsWUFBUUMsR0FBUixnQ0FBeUMsS0FBS2IscUJBQTlDLFNBQXdFVyxDQUF4RTtBQUNBLFFBQUlTLE9BQU8sSUFBWDtBQUNBQyxlQUFXLFlBQVU7QUFDakJULGdCQUFRQyxHQUFSLENBQVksa0NBQVo7QUFDQU8sYUFBS2xCLElBQUwsQ0FBVWtCLEtBQUtqQixHQUFmO0FBQ0gsS0FIRCxFQUdFLEtBQUtILHFCQUhQO0FBSUgsQ0FQRDtBQVFBRixnQkFBZ0JHLFNBQWhCLENBQTBCSyxNQUExQixHQUFtQyxVQUFTSyxDQUFULEVBQVc7QUFBRUMsWUFBUUMsR0FBUixDQUFZLHVCQUFaLEVBQW9DUyxTQUFwQztBQUFpRCxDQUFqRztBQUNBeEIsZ0JBQWdCRyxTQUFoQixDQUEwQk0sU0FBMUIsR0FBc0MsVUFBU0MsSUFBVCxFQUFjQyxLQUFkLEVBQW9CVixNQUFwQixFQUEyQjtBQUFFYSxZQUFRQyxHQUFSLENBQVksMEJBQVosRUFBdUNTLFNBQXZDO0FBQW9ELENBQXZIO0FBQ0F4QixnQkFBZ0JHLFNBQWhCLENBQTBCYyxPQUExQixHQUFvQyxVQUFTSixDQUFULEVBQVc7QUFBRUMsWUFBUUMsR0FBUixDQUFZLHdCQUFaLEVBQXFDUyxTQUFyQztBQUFrRCxDQUFuRztBQUNBeEIsZ0JBQWdCRyxTQUFoQixDQUEwQlMsT0FBMUIsR0FBb0MsVUFBU0MsQ0FBVCxFQUFXO0FBQUVDLFlBQVFDLEdBQVIsQ0FBWSx5QkFBWixFQUFzQ1MsU0FBdEM7QUFBbUQsQ0FBcEc7O0FBR0EsSUFBSUMsT0FBTyxJQUFJekIsZUFBSixFQUFYO0FBQ0F5QixLQUFLckIsSUFBTCxDQUFVLFVBQVVzQixPQUFPQyxRQUFQLENBQWdCQyxJQUExQixHQUFpQyxRQUEzQztBQUNBSCxLQUFLaEIsU0FBTCxHQUFpQixVQUFTb0IsS0FBVCxFQUFnQjtBQUM3QmYsWUFBUUMsR0FBUixDQUFZYyxLQUFaO0FBQ0EsUUFBSUMsTUFBTUMsS0FBS0MsS0FBTCxDQUFXSCxNQUFNbkIsSUFBakIsQ0FBVjtBQUNBSSxZQUFRQyxHQUFSLENBQVllLEdBQVo7O0FBRUEsUUFBS0EsSUFBSUcsU0FBSixLQUFrQixJQUF2QixFQUE2QjtBQUN6QkMsaUJBQVNQLFFBQVQsQ0FBa0JRLE1BQWxCLENBQXlCLElBQXpCO0FBQ0gsS0FGRCxNQUVPLElBQUlMLElBQUlNLFVBQVIsRUFBb0I7QUFDdkIsWUFBSUMsVUFBVVAsSUFBSU0sVUFBSixDQUFlQyxPQUE3QjtBQUNBLFlBQUlDLFFBQVFDLEVBQUUsV0FBU0YsT0FBWCxDQUFaO0FBQ0E7QUFDQUMsY0FBTUUsV0FBTixDQUFrQixRQUFsQjtBQUNBRixjQUFNRSxXQUFOLENBQWtCLE9BQWxCO0FBQ0FGLGNBQU1FLFdBQU4sQ0FBa0IsYUFBbEI7QUFDQUYsY0FBTUUsV0FBTixDQUFrQixRQUFsQjtBQUNBRixjQUFNRSxXQUFOLENBQWtCLFNBQWxCO0FBQ0FGLGNBQU1HLFFBQU4sQ0FBZVgsSUFBSU0sVUFBSixDQUFlTSxVQUE5QjtBQUNBLFlBQUlaLElBQUlNLFVBQUosQ0FBZU8sT0FBZixJQUEwQmIsSUFBSU0sVUFBSixDQUFlTSxVQUFmLElBQTZCLGFBQTNELEVBQTBFO0FBQ3RFSixrQkFBTUcsUUFBTixDQUFlLFFBQWY7QUFDSDtBQUNESCxjQUFNTSxJQUFOLENBQVcsTUFBWCxFQUFtQkMsSUFBbkIsQ0FBd0JmLElBQUlNLFVBQUosQ0FBZU0sVUFBdkM7QUFDSDtBQUNKLENBdEJEIiwiZmlsZSI6IndzX3JlbG9hZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuZnVuY3Rpb24gV2ViU29ja2V0Q2xpZW50KCl7XG4gICAgdGhpcy5udW1iZXIgPSAwO1x0Ly8gTWVzc2FnZSBudW1iZXJcbiAgICB0aGlzLmF1dG9SZWNvbm5lY3RJbnRlcnZhbCA9IDEwMDA7XHQvLyBtc1xufVxuV2ViU29ja2V0Q2xpZW50LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24odXJsKXtcbiAgICB0aGlzLnVybCA9IHVybDtcbiAgICB0aGlzLmluc3RhbmNlID0gbmV3IFdlYlNvY2tldCh0aGlzLnVybCk7XG4gICAgdGhpcy5pbnN0YW5jZS5vbm9wZW4gPSAoKSA9PiB7XG4gICAgICAgIHRoaXMub25vcGVuKCk7XG4gICAgfTtcbiAgICB0aGlzLmluc3RhbmNlLm9ubWVzc2FnZSA9IChkYXRhLGZsYWdzKT0+IHtcbiAgICAgICAgdGhpcy5udW1iZXIrKztcbiAgICAgICAgdGhpcy5vbm1lc3NhZ2UoZGF0YSwgZmxhZ3MsIHRoaXMubnVtYmVyKTtcbiAgICB9O1xuICAgIHRoaXMuaW5zdGFuY2Uub25jbG9zZSA9IChlKT0+e1xuICAgICAgICBzd2l0Y2ggKGUpe1xuICAgICAgICAgICAgY2FzZSAxMDAwOlx0Ly8gQ0xPU0VfTk9STUFMXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXZWJTb2NrZXQ6IGNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XHQvLyBBYm5vcm1hbCBjbG9zdXJlXG4gICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3QoZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vbmNsb3NlKGUpO1xuICAgIH07XG4gICAgdGhpcy5pbnN0YW5jZS5vbmVycm9yID0gKGUpPT57XG4gICAgICAgIHN3aXRjaCAoZS5jb2RlKXtcbiAgICAgICAgICAgIGNhc2UgJ0VDT05OUkVGVVNFRCc6XG4gICAgICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3QoZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRoaXMub25lcnJvcihlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG59O1xuV2ViU29ja2V0Q2xpZW50LnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24oZGF0YSxvcHRpb24pe1xuICAgIHRyeXtcbiAgICAgICAgdGhpcy5pbnN0YW5jZS5zZW5kKGRhdGEsb3B0aW9uKTtcbiAgICB9Y2F0Y2ggKGUpe1xuICAgICAgICB0aGlzLmluc3RhbmNlLmVtaXQoJ2Vycm9yJyxlKTtcbiAgICB9XG59O1xuV2ViU29ja2V0Q2xpZW50LnByb3RvdHlwZS5yZWNvbm5lY3QgPSBmdW5jdGlvbihlKXtcbiAgICBjb25zb2xlLmxvZyhgV2ViU29ja2V0Q2xpZW50OiByZXRyeSBpbiAke3RoaXMuYXV0b1JlY29ubmVjdEludGVydmFsfW1zYCxlKTtcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICBjb25zb2xlLmxvZyhcIldlYlNvY2tldENsaWVudDogcmVjb25uZWN0aW5nLi4uXCIpO1xuICAgICAgICB0aGF0Lm9wZW4odGhhdC51cmwpO1xuICAgIH0sdGhpcy5hdXRvUmVjb25uZWN0SW50ZXJ2YWwpO1xufTtcbldlYlNvY2tldENsaWVudC5wcm90b3R5cGUub25vcGVuID0gZnVuY3Rpb24oZSl7XHRjb25zb2xlLmxvZyhcIldlYlNvY2tldENsaWVudDogb3BlblwiLGFyZ3VtZW50cyk7XHR9O1xuV2ViU29ja2V0Q2xpZW50LnByb3RvdHlwZS5vbm1lc3NhZ2UgPSBmdW5jdGlvbihkYXRhLGZsYWdzLG51bWJlcil7XHRjb25zb2xlLmxvZyhcIldlYlNvY2tldENsaWVudDogbWVzc2FnZVwiLGFyZ3VtZW50cyk7XHR9O1xuV2ViU29ja2V0Q2xpZW50LnByb3RvdHlwZS5vbmVycm9yID0gZnVuY3Rpb24oZSl7XHRjb25zb2xlLmxvZyhcIldlYlNvY2tldENsaWVudDogZXJyb3JcIixhcmd1bWVudHMpO1x0fTtcbldlYlNvY2tldENsaWVudC5wcm90b3R5cGUub25jbG9zZSA9IGZ1bmN0aW9uKGUpe1x0Y29uc29sZS5sb2coXCJXZWJTb2NrZXRDbGllbnQ6IGNsb3NlZFwiLGFyZ3VtZW50cyk7XHR9O1xuXG5cbnZhciBzb2NrID0gbmV3IFdlYlNvY2tldENsaWVudCgpO1xuc29jay5vcGVuKCd3czovLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArICcvdWkvd3MnKTtcbnNvY2sub25tZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhldmVudCk7XG4gICAgdmFyIG9iaiA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XG4gICAgY29uc29sZS5sb2cob2JqKTtcblxuICAgIGlmICggb2JqLmRvX3JlbG9hZCA9PT0gdHJ1ZSkge1xuICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5yZWxvYWQodHJ1ZSk7XG4gICAgfSBlbHNlIGlmIChvYmouY2VsbF9ldmVudCkge1xuICAgICAgICB2YXIgY2VsbF9pZCA9IG9iai5jZWxsX2V2ZW50LmNlbGxfaWQ7XG4gICAgICAgIHZhciAkY2VsbCA9ICQoXCIjY2VsbC1cIitjZWxsX2lkKTtcbiAgICAgICAgLy8gUmVzZXQgY2xhc3Nlcy4gVE9ETzogZmluZCBtb3JlIGdlbmVyaWMgd2F5XG4gICAgICAgICRjZWxsLnJlbW92ZUNsYXNzKFwib3BlbmVkXCIpO1xuICAgICAgICAkY2VsbC5yZW1vdmVDbGFzcyhcImRpcnR5XCIpO1xuICAgICAgICAkY2VsbC5yZW1vdmVDbGFzcyhcIm9wZXJhdGlvbmFsXCIpO1xuICAgICAgICAkY2VsbC5yZW1vdmVDbGFzcyhcImJyb2tlblwiKTtcbiAgICAgICAgJGNlbGwucmVtb3ZlQ2xhc3MoXCJibG9ja2VkXCIpO1xuICAgICAgICAkY2VsbC5hZGRDbGFzcyhvYmouY2VsbF9ldmVudC5jZWxsX3N0YXRlKTtcbiAgICAgICAgaWYgKG9iai5jZWxsX2V2ZW50LmlzX29wZW4gJiYgb2JqLmNlbGxfZXZlbnQuY2VsbF9zdGF0ZSA9PSBcIm9wZXJhdGlvbmFsXCIpIHtcbiAgICAgICAgICAgICRjZWxsLmFkZENsYXNzKFwib3BlbmVkXCIpO1xuICAgICAgICB9XG4gICAgICAgICRjZWxsLmZpbmQoJ3NwYW4nKS50ZXh0KG9iai5jZWxsX2V2ZW50LmNlbGxfc3RhdGUpO1xuICAgIH1cbn07Il19
